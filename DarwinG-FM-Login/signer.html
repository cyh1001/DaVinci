<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaMask Message Signer</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; padding: 20px; max-width: 800px; margin: auto; background-color: #f4f4f9; color: #333; }
        h1, h2 { color: #1a1a1a; }
        textarea { width: 100%; min-height: 250px; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-family: monospace; font-size: 14px; margin-bottom: 15px; }
        button { background-color: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; display: block; width: 100%; margin-bottom: 15px; }
        button:hover { background-color: #0056b3; }
        #signature-output { margin-top: 20px; padding: 15px; background-color: #e9ecef; border: 1px solid #ced4da; border-radius: 8px; word-wrap: break-word; font-family: monospace; }
        .error { color: #dc3545; }
        .instructions { background-color: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff; }
    </style>
</head>
<body>

    <h1>MetaMask Message Signer</h1>
    <div class="instructions">
        <p>This tool helps you sign a message with MetaMask. Use it with the <code>capture_real_metamask_login.py</code> script.</p>
        <ol>
            <li>Run <code>python capture_real_metamask_login.py</code> in your terminal.</li>
            <li>Copy the <strong>"EXACT MESSAGE TO SIGN"</strong> from the terminal output.</li>
            <li>Paste the message into the text area below.</li>
            <li>Click "Connect Wallet & Sign Message".</li>
            <li>Approve the signing request in MetaMask.</li>
            <li>Copy the generated signature and paste it back into the terminal.</li>
        </ol>
    </div>

    <h2>Message to Sign</h2>
    <textarea id="message" placeholder="Paste the message from the Python script here..."></textarea>

    <button id="signButton">Connect Wallet & Sign Message</button>

    <h2>Generated Signature</h2>
    <div id="signature-output">Awaiting signature...</div>
    <p class="error" id="error-output"></p>

    <script>
        const signButton = document.getElementById('signButton');
        const signatureOutput = document.getElementById('signature-output');
        const errorOutput = document.getElementById('error-output');
        const messageTextarea = document.getElementById('message');

        signButton.addEventListener('click', async () => {
            signatureOutput.textContent = 'Awaiting signature...';
            errorOutput.textContent = '';

            if (typeof window.ethereum === 'undefined') {
                errorOutput.textContent = 'MetaMask is not installed. Please install it to use this tool.';
                return;
            }

            try {
                // 1. Request account access
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const account = accounts[0];
                
                if (!account) {
                    errorOutput.textContent = 'Could not get a wallet account. Please connect to MetaMask.';
                    return;
                }

                // 2. Get message from textarea
                const message = messageTextarea.value;
                if (!message.trim()) {
                    errorOutput.textContent = 'Message is empty. Please paste the message from the script.';
                    return;
                }

                // 3. Sign the message
                const signature = await window.ethereum.request({
                    method: 'personal_sign',
                    params: [message, account],
                });

                signatureOutput.textContent = signature;

            } catch (err) {
                console.error(err);
                errorOutput.textContent = `Error: ${err.message}`;
            }
        });
    </script>

</body>
</html>
